<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Continuous Improvement Monitoring - With Photos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            background: #1976d2;
            color: white;
            padding: 20px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .demo-badge {
            background: #ffc107;
            color: #1976d2;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        
        /* Login Box */
        .login-container {
            max-width: 450px;
            margin: 30px auto;
        }
        
        .login-box {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .login-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
            text-align: center;
        }
        
        .login-body {
            padding: 30px;
        }
        
        .info-box {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
            font-size: 14px;
            color: #0d47a1;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #1976d2;
        }
        
        /* File Upload */
        .upload-container {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }
        
        .upload-container:hover {
            border-color: #1976d2;
            background: #f5f5f5;
        }
        
        .upload-container i {
            font-size: 40px;
            color: #757575;
            margin-bottom: 10px;
            display: block;
        }
        
        .upload-container p {
            color: #757575;
        }
        
        .upload-container small {
            color: #999;
            font-size: 12px;
        }
        
        .preview-container {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .preview-item {
            flex: 1;
            min-width: 200px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .preview-item .preview-label {
            background: #f5f5f5;
            padding: 8px;
            font-weight: 500;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .preview-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }
        
        .preview-item .no-image {
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fafafa;
            color: #999;
        }
        
        .remove-image {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            width: 100%;
            cursor: pointer;
            font-size: 12px;
        }
        
        .remove-image:hover {
            background: #c82333;
        }
        
        /* Photo Gallery */
        .photo-gallery {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .photo-item {
            flex: 1;
            min-width: 200px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .photo-item .photo-label {
            background: #f5f5f5;
            padding: 8px;
            font-weight: 500;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .photo-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }
        
        .photo-item .no-photo {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fafafa;
            color: #999;
        }
        
        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn-primary {
            background: #1976d2;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1565c0;
        }
        
        .btn-success {
            background: #2e7d32;
            color: white;
        }
        
        .btn-success:hover {
            background: #1b5e20;
        }
        
        .btn-danger {
            background: #d32f2f;
            color: white;
        }
        
        .btn-danger:hover {
            background: #b71c1c;
        }
        
        .btn-secondary {
            background: #757575;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #616161;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }
        
        .role-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .role-btn {
            background: #f5f5f5;
            border: 1px solid #ddd;
            padding: 8px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }
        
        .role-btn:hover {
            background: #e0e0e0;
            border-color: #1976d2;
        }
        
        /* Dashboard */
        .dashboard {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 25px;
        }
        
        .user-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-detail {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .user-role {
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .create-form {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .create-form h3 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .tabs {
            display: flex;
            gap: 5px;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 25px;
        }
        
        .tab {
            padding: 12px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: #757575;
            position: relative;
        }
        
        .tab.active {
            color: #1976d2;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #1976d2;
        }
        
        /* Cards */
        .improvement-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: box-shadow 0.3s;
        }
        
        .improvement-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .card-desc {
            color: #666;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-pending {
            background: #fff3e0;
            color: #e65100;
        }
        
        .status-approved {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .status-rejected {
            background: #ffebee;
            color: #c62828;
        }
        
        .card-meta {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            padding: 15px 0;
            border-top: 1px solid #e0e0e0;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .meta-item {
            color: #666;
        }
        
        .meta-item strong {
            color: #333;
            display: block;
            margin-bottom: 5px;
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .modal-header h3 {
            color: #333;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #dee2e6;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .info-display {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .info-display p {
            margin: 5px 0;
            color: #333;
        }
        
        .hidden {
            display: none;
        }
        
        .flex {
            display: flex;
            gap: 10px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #757575;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Continuous Improvement Monitoring</h1>
            <span class="demo-badge">DEMO</span>
        </div>

        <!-- Login Section -->
        <div id="loginSection" class="login-container">
            <div class="login-box">
                <div class="login-header">
                    <h2>Login</h2>
                </div>
                <div class="login-body">
                    <div class="info-box">
                        <strong>üîê Demo Credentials:</strong>
                        Staff: staff@demo.com / staff123<br>
                        Manager: manager@demo.com / manager123<br>
                        Director: director@demo.com / director123
                    </div>

                    <form id="loginForm">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="email" class="form-control" value="staff@demo.com" required>
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="password" class="form-control" value="staff123" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Login</button>
                    </form>

                    <div class="role-buttons">
                        <button type="button" class="role-btn" onclick="fillLogin('staff@demo.com', 'staff123')">Staff</button>
                        <button type="button" class="role-btn" onclick="fillLogin('manager@demo.com', 'manager123')">Manager</button>
                        <button type="button" class="role-btn" onclick="fillLogin('director@demo.com', 'director123')">Director</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="dashboard hidden">
            <!-- User Info -->
            <div class="user-info">
                <div class="user-detail">
                    <span class="user-name" id="userName"></span>
                    <span class="user-role" id="userRole"></span>
                </div>
                <button onclick="logout()" class="btn btn-danger btn-small">Logout</button>
            </div>

            <!-- Create Button -->
            <button onclick="showCreateForm()" class="btn btn-success" style="margin-bottom: 20px;">
                + Buat Improvement Baru
            </button>

            <!-- Create Form -->
            <div id="createForm" class="create-form hidden">
                <h3>Buat Improvement Baru</h3>
                <form id="improvementForm">
                    <div class="form-group">
                        <label>Judul Improvement</label>
                        <input type="text" id="title" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Deskripsi</label>
                        <textarea id="description" class="form-control" rows="4" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Kategori</label>
                        <select id="category" class="form-control">
                            <option value="process">Process Improvement</option>
                            <option value="quality">Quality Improvement</option>
                            <option value="cost">Cost Reduction</option>
                            <option value="safety">Safety</option>
                        </select>
                    </div>

                    <!-- Upload Foto Before -->
                    <div class="form-group">
                        <label>Foto Before (Kondisi Awal)</label>
                        <div class="upload-container" onclick="document.getElementById('fileBefore').click()">
                            <i>üì∏</i>
                            <p>Klik untuk upload foto before</p>
                            <small>Format: JPG, PNG (Max 5MB)</small>
                        </div>
                        <input type="file" id="fileBefore" accept="image/*" class="hidden" onchange="previewBefore(event)">
                        <div id="previewBefore" class="preview-container"></div>
                    </div>

                    <!-- Upload Foto After -->
                    <div class="form-group">
                        <label>Foto After (Kondisi Setelah Improvement)</label>
                        <div class="upload-container" onclick="document.getElementById('fileAfter').click()">
                            <i>üì∏</i>
                            <p>Klik untuk upload foto after</p>
                            <small>Format: JPG, PNG (Max 5MB)</small>
                        </div>
                        <input type="file" id="fileAfter" accept="image/*" class="hidden" onchange="previewAfter(event)">
                        <div id="previewAfter" class="preview-container"></div>
                    </div>
                    
                    <div class="flex">
                        <button type="submit" class="btn btn-primary">Submit</button>
                        <button type="button" onclick="hideCreateForm()" class="btn btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" id="pendingTab" onclick="loadData('pending')">Pending Approval</button>
                <button class="tab" id="myTab" onclick="loadData('my')">Improvement Saya</button>
                <button class="tab" id="allTab" onclick="loadData('all')">Semua Improvement</button>
            </div>

            <!-- Improvements List -->
            <div id="improvementsList"></div>
        </div>
    </div>

    <!-- Approval Modal -->
    <div id="approvalModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Approval Improvement</h3>
            </div>
            <div class="modal-body">
                <div class="info-display" id="modalInfo"></div>
                
                <!-- Foto di Modal Approval -->
                <div id="modalPhotos" class="photo-gallery"></div>
                
                <div class="form-group">
                    <label>Keputusan</label>
                    <select id="approvalAction" class="form-control">
                        <option value="approved">Approve</option>
                        <option value="rejected">Reject</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Komentar</label>
                    <textarea id="approvalComments" class="form-control" rows="3" placeholder="Tambahkan komentar..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="submitApproval()" class="btn btn-primary">Submit</button>
                <button onclick="closeModal()" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Detail Improvement</h3>
            </div>
            <div class="modal-body">
                <div id="detailInfo"></div>
                <div id="detailPhotos" class="photo-gallery"></div>
            </div>
            <div class="modal-footer">
                <button onclick="closeDetailModal()" class="btn btn-primary">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Data Store
        let currentUser = null;
        let currentImprovementId = null;
        
        let improvements = [
            {
                id: '1',
                title: 'Optimasi Proses Produksi',
                description: 'Mengusulkan perubahan layout produksi untuk efisiensi 20%',
                category: 'process',
                proposerId: 'staff1',
                proposerName: 'Staff Demo',
                proposerRole: 'staff',
                status: 'pending',
                currentLevel: 1,
                maxLevel: 2,
                createdAt: new Date().toISOString(),
                photoBefore: null,
                photoAfter: null
            },
            {
                id: '2',
                title: 'Reduksi Waste Material',
                description: 'Implementasi metode lean manufacturing untuk mengurangi scrap',
                category: 'cost',
                proposerId: 'staff1',
                proposerName: 'Staff Demo',
                proposerRole: 'staff',
                status: 'approved',
                currentLevel: 2,
                maxLevel: 2,
                createdAt: new Date(Date.now() - 86400000).toISOString(),
                photoBefore: null,
                photoAfter: null
            },
            {
                id: '3',
                title: 'Program Safety Training',
                description: 'Pelatihan K3 untuk seluruh karyawan',
                category: 'safety',
                proposerId: 'manager1',
                proposerName: 'Manager Demo',
                proposerRole: 'manager',
                status: 'pending',
                currentLevel: 2,
                maxLevel: 2,
                createdAt: new Date(Date.now() - 172800000).toISOString(),
                photoBefore: null,
                photoAfter: null
            }
        ];

        // File Upload State
        let photoBeforeData = null;
        let photoAfterData = null;

        // Helper Functions
        window.fillLogin = function(email, password) {
            document.getElementById('email').value = email;
            document.getElementById('password').value = password;
        };

        // Preview Functions
        window.previewBefore = function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    photoBeforeData = e.target.result;
                    document.getElementById('previewBefore').innerHTML = `
                        <div class="preview-item">
                            <div class="preview-label">Foto Before</div>
                            <img src="${e.target.result}" alt="Preview Before">
                            <button type="button" class="remove-image" onclick="removeBefore()">Hapus</button>
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
            }
        };

        window.previewAfter = function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    photoAfterData = e.target.result;
                    document.getElementById('previewAfter').innerHTML = `
                        <div class="preview-item">
                            <div class="preview-label">Foto After</div>
                            <img src="${e.target.result}" alt="Preview After">
                            <button type="button" class="remove-image" onclick="removeAfter()">Hapus</button>
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
            }
        };

        window.removeBefore = function() {
            photoBeforeData = null;
            document.getElementById('previewBefore').innerHTML = '';
            document.getElementById('fileBefore').value = '';
        };

        window.removeAfter = function() {
            photoAfterData = null;
            document.getElementById('previewAfter').innerHTML = '';
            document.getElementById('fileAfter').value = '';
        };

        // Login Handler
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (email === 'staff@demo.com' && password === 'staff123') {
                currentUser = {
                    id: 'staff1',
                    name: 'Staff Demo',
                    role: 'staff'
                };
            } else if (email === 'manager@demo.com' && password === 'manager123') {
                currentUser = {
                    id: 'manager1',
                    name: 'Manager Demo',
                    role: 'manager'
                };
            } else if (email === 'director@demo.com' && password === 'director123') {
                currentUser = {
                    id: 'director1',
                    name: 'Director Demo',
                    role: 'director'
                };
            } else {
                alert('Email atau password salah!');
                return;
            }

            // Update UI
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userRole').textContent = currentUser.role;
            
            loadData('pending');
        });

        // Logout
        window.logout = function() {
            currentUser = null;
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('dashboardSection').classList.add('hidden');
        };

        // Create Improvement
        document.getElementById('improvementForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;
            const category = document.getElementById('category').value;

            if (!title || !description) {
                alert('Judul dan deskripsi harus diisi!');
                return;
            }

            const newImprovement = {
                id: Date.now().toString(),
                title: title,
                description: description,
                category: category,
                proposerId: currentUser.id,
                proposerName: currentUser.name,
                proposerRole: currentUser.role,
                status: 'pending',
                currentLevel: 1,
                maxLevel: 2,
                createdAt: new Date().toISOString(),
                photoBefore: photoBeforeData,
                photoAfter: photoAfterData
            };

            improvements.unshift(newImprovement);
            
            alert('Improvement berhasil dibuat!');
            
            // Reset form
            hideCreateForm();
            removeBefore();
            removeAfter();
            
            loadData('my');
        });

        window.showCreateForm = function() {
            document.getElementById('createForm').classList.remove('hidden');
        };

        window.hideCreateForm = function() {
            document.getElementById('createForm').classList.add('hidden');
            document.getElementById('improvementForm').reset();
            removeBefore();
            removeAfter();
        };

        // Load Data
        window.loadData = function(type) {
            // Update tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(type + 'Tab').classList.add('active');

            let filtered = [];
            
            if (type === 'my') {
                filtered = improvements.filter(imp => imp.proposerId === currentUser.id);
            } else if (type === 'pending') {
                if (currentUser.role === 'manager') {
                    filtered = improvements.filter(imp => imp.status === 'pending' && imp.currentLevel === 1);
                } else if (currentUser.role === 'director') {
                    filtered = improvements.filter(imp => imp.status === 'pending' && imp.currentLevel === 2);
                } else {
                    filtered = improvements.filter(imp => imp.status === 'pending');
                }
            } else {
                filtered = improvements;
            }

            displayImprovements(filtered);
        };

        function displayImprovements(items) {
            const container = document.getElementById('improvementsList');
            
            if (items.length === 0) {
                container.innerHTML = '<div class="empty-state">Tidak ada improvement ditemukan</div>';
                return;
            }

            container.innerHTML = items.map(item => {
                const hasPhotos = item.photoBefore || item.photoAfter;
                
                return `
                <div class="improvement-card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">${item.title}</div>
                            <div class="card-desc">${item.description}</div>
                        </div>
                        <span class="status-badge status-${item.status}">${item.status}</span>
                    </div>
                    
                    ${hasPhotos ? `
                        <div class="photo-gallery" style="margin-bottom: 15px;">
                            ${item.photoBefore ? `
                                <div class="photo-item">
                                    <div class="photo-label">Before</div>
                                    <img src="${item.photoBefore}" alt="Before" onclick="openDetail('${item.id}')" style="cursor: pointer;">
                                </div>
                            ` : ''}
                            ${item.photoAfter ? `
                                <div class="photo-item">
                                    <div class="photo-label">After</div>
                                    <img src="${item.photoAfter}" alt="After" onclick="openDetail('${item.id}')" style="cursor: pointer;">
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                    
                    <div class="card-meta">
                        <div class="meta-item">
                            <strong>Kategori</strong>
                            ${item.category}
                        </div>
                        <div class="meta-item">
                            <strong>Pembuat</strong>
                            ${item.proposerName}
                        </div>
                        <div class="meta-item">
                            <strong>Tanggal</strong>
                            ${new Date(item.createdAt).toLocaleDateString('id-ID')}
                        </div>
                        <div class="meta-item">
                            <strong>Level</strong>
                            ${item.currentLevel}/${item.maxLevel}
                        </div>
                    </div>

                    <div class="flex">
                        ${canApprove(item) ? `
                            <button onclick="openApprovalModal('${item.id}')" class="btn btn-primary btn-small">
                                Review & Approve
                            </button>
                        ` : ''}
                        <button onclick="openDetail('${item.id}')" class="btn btn-secondary btn-small">
                            Lihat Detail
                        </button>
                    </div>
                </div>
            `}).join('');
        }

        function canApprove(item) {
            if (!currentUser || item.status !== 'pending') return false;
            if (currentUser.role === 'manager' && item.currentLevel === 1) return true;
            if (currentUser.role === 'director' && item.currentLevel === 2) return true;
            return false;
        }

        // Detail Modal
        window.openDetail = function(id) {
            const item = improvements.find(i => i.id === id);
            
            document.getElementById('detailInfo').innerHTML = `
                <h4 style="margin-bottom: 10px;">${item.title}</h4>
                <p style="margin-bottom: 10px;">${item.description}</p>
                <p><strong>Kategori:</strong> ${item.category}</p>
                <p><strong>Status:</strong> ${item.status}</p>
                <p><strong>Level:</strong> ${item.currentLevel}/${item.maxLevel}</p>
                <p><strong>Dibuat oleh:</strong> ${item.proposerName}</p>
                <p><strong>Tanggal:</strong> ${new Date(item.createdAt).toLocaleDateString('id-ID')}</p>
            `;
            
            document.getElementById('detailPhotos').innerHTML = `
                ${item.photoBefore ? `
                    <div class="photo-item">
                        <div class="photo-label">Foto Before</div>
                        <img src="${item.photoBefore}" alt="Before">
                    </div>
                ` : ''}
                ${item.photoAfter ? `
                    <div class="photo-item">
                        <div class="photo-label">Foto After</div>
                        <img src="${item.photoAfter}" alt="After">
                    </div>
                ` : ''}
                ${!item.photoBefore && !item.photoAfter ? '<p class="text-center" style="color: #999;">Tidak ada foto</p>' : ''}
            `;
            
            document.getElementById('detailModal').classList.remove('hidden');
        };

        window.closeDetailModal = function() {
            document.getElementById('detailModal').classList.add('hidden');
        };

        // Approval Modal
        window.openApprovalModal = function(id) {
            currentImprovementId = id;
            const item = improvements.find(i => i.id === id);
            
            document.getElementById('modalInfo').innerHTML = `
                <p><strong>Judul:</strong> ${item.title}</p>
                <p><strong>Level Saat Ini:</strong> ${item.currentLevel}/${item.maxLevel}</p>
            `;
            
            document.getElementById('modalPhotos').innerHTML = `
                ${item.photoBefore ? `
                    <div class="photo-item">
                        <div class="photo-label">Before</div>
                        <img src="${item.photoBefore}" alt="Before">
                    </div>
                ` : ''}
                ${item.photoAfter ? `
                    <div class="photo-item">
                        <div class="photo-label">After</div>
                        <img src="${item.photoAfter}" alt="After">
                    </div>
                ` : ''}
            `;
            
            document.getElementById('approvalModal').classList.remove('hidden');
        };

        window.closeModal = function() {
            document.getElementById('approvalModal').classList.add('hidden');
            document.getElementById('approvalComments').value = '';
        };

        window.submitApproval = function() {
            const action = document.getElementById('approvalAction').value;
            const comments = document.getElementById('approvalComments').value;
            
            const item = improvements.find(i => i.id === currentImprovementId);
            
            if (action === 'rejected') {
                item.status = 'rejected';
            } else {
                if (item.currentLevel >= item.maxLevel) {
                    item.status = 'approved';
                } else {
                    item.currentLevel++;
                }
            }

            alert(`Improvement berhasil di-${action === 'approved' ? 'approve' : 'reject'}!`);
            closeModal();
            
            const activeTab = document.querySelector('.tab.active').id.replace('Tab', '');
            loadData(activeTab);
        };
    </script>
</body>
</html>
