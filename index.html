<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CI Multi-Channel - PRIMA+</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background: #f5f5f5;
            min-height: 100vh;
        }

        /* Header */
        .top-header {
            background: white;
            padding: 12px 25px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #1e3a8a;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .menu-btn:hover {
            background: #f0f0f0;
        }

        .logo {
            font-weight: bold;
            color: #1e3a8a;
            font-size: 18px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-detail {
            text-align: right;
        }

        .user-name {
            font-weight: 600;
            color: #333;
        }

        .user-id {
            font-size: 12px;
            color: #666;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: #1e3a8a;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .role-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .role-badge.staff { background: #dcfce7; color: #16a34a; }
        .role-badge.supervisor { background: #cffafe; color: #0891b2; }
        .role-badge.manager { background: #ffedd5; color: #ea580c; }
        .role-badge.superadmin { background: #f3e8ff; color: #9333ea; }

        .logout-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100vh;
            background: #1e3a8a;
            color: white;
            transition: left 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h3 {
            font-size: 16px;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0 5px;
        }

        .nav-menu {
            padding: 15px 0;
        }

        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 14px;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .nav-item.active {
            background: #2563eb;
            border-left: 4px solid #fbbf24;
        }

        .nav-submenu {
            padding-left: 35px;
            font-size: 13px;
            opacity: 0.9;
        }

        .nav-submenu-item {
            padding: 8px 0;
            cursor: pointer;
        }

        .nav-divider {
            height: 1px;
            background: rgba(255,255,255,0.1);
            margin: 15px 0;
        }

        /* Overlay */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .overlay.show {
            display: block;
        }

        /* Main Content */
        .main-content {
            padding: 20px;
            transition: margin-left 0.3s;
        }

        /* Channel Cards */
        .channel-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        @media (max-width: 1024px) {
            .channel-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .channel-grid {
                grid-template-columns: 1fr;
            }
        }

        .channel-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 4px solid;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .channel-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .channel-card.ss { border-left-color: #16a34a; }
        .channel-card.qcc { border-left-color: #ea580c; }
        .channel-card.qcp { border-left-color: #9333ea; }
        .channel-card.osr { border-left-color: #0891b2; }

        .channel-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .channel-desc {
            font-size: 13px;
            color: #666;
            margin-bottom: 15px;
        }

        .channel-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #999;
        }

        .channel-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .channel-badge.pending { background: #ffedd5; color: #ea580c; }
        .channel-badge.approved { background: #dcfce7; color: #16a34a; }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .stat-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #1e3a8a;
        }

        /* Table Section */
        .table-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
        }

        .btn {
            padding: 8px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn:hover {
            opacity: 0.9;
            transform: scale(0.98);
        }

        .btn-primary {
            background: #1e3a8a;
            color: white;
        }

        .btn-success {
            background: #16a34a;
            color: white;
        }

        .btn-warning {
            background: #ea580c;
            color: white;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            min-width: 800px;
        }

        th {
            background: #f8fafc;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            color: #333;
        }

        td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .item-name {
            text-align: left;
            font-weight: 500;
        }

        .status-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .status-pending { background: #ffedd5; color: #ea580c; }
        .status-approved { background: #dcfce7; color: #16a34a; }
        .status-rejected { background: #fee2e2; color: #dc2626; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 25px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #1e3a8a;
        }

        .modal-close {
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .modal-close:hover {
            color: #333;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .info-box {
            background: #e5e7eb;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 13px;
        }

        .info-highlight {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #1e3a8a;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: #1e3a8a;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 80px;
        }

        /* Login Box */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
        }

        .login-box {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .login-header {
            background: #1e3a8a;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .login-body {
            padding: 30px;
        }

        .btn-login {
            width: 100%;
            padding: 12px;
            background: #1e3a8a;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }

        .role-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .role-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            font-size: 12px;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #666;
            font-size: 13px;
        }

        .hidden { display: none; }
        .mt-20 { margin-top: 20px; }
        .text-success { color: #16a34a; }
        .text-warning { color: #ea580c; }
        .text-danger { color: #dc2626; }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="top-header">
        <div class="header-left">
            <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
            <span class="logo">CI MULTI-CHANNEL</span>
        </div>
        <div class="user-info">
            <div class="user-detail">
                <div class="user-name" id="userName">-</div>
                <div class="user-id" id="userId">-</div>
            </div>
            <div class="user-avatar" id="userAvatar">U</div>
            <span class="role-badge" id="roleBadge">-</span>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>NAVIGATION</h3>
            <button class="close-btn" onclick="toggleSidebar()">√ó</button>
        </div>
        <div class="nav-menu">
            <div class="nav-item active" onclick="navigateTo('dashboard')">
                üìä Dashboard
            </div>
            <div class="nav-item" onclick="navigateTo('ss')">
                üí° SS (Suggestion System)
            </div>
            <div class="nav-item" onclick="navigateTo('qcc')">
                ‚≠ï QCC (Quality Circle Control)
            </div>
            <div class="nav-item" onclick="navigateTo('qcp')">
                üîÑ QCP (Quality Circle Project)
            </div>
            <div class="nav-item" onclick="navigateTo('osr')">
                üìã OSR (One Sheet Report)
            </div>
            <div class="nav-divider"></div>
            <div class="nav-item" onclick="showManualBook()">
                üìö Manual Book
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Login Section -->
        <div id="loginSection" class="login-container">
            <div class="login-box">
                <div class="login-header">
                    <h2>CI MULTI-CHANNEL</h2>
                    <p style="opacity:0.9;margin-top:10px;">PRIMA+ COURSE</p>
                </div>
                <div class="login-body">
                    <div class="info-box">
                        <strong>üìã 4 LEVEL ROLE:</strong><br>
                        ‚Ä¢ Staff: staff@demo.com / 123<br>
                        ‚Ä¢ Supervisor: supervisor@demo.com / 123<br>
                        ‚Ä¢ Manager: manager@demo.com / 123<br>
                        ‚Ä¢ Superadmin: admin@demo.com / 123
                    </div>
                    <form id="loginForm" onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="email" class="form-control" value="staff@demo.com" required>
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="password" class="form-control" value="123" required>
                        </div>
                        <button type="submit" class="btn-login">Login</button>
                    </form>
                    <div class="role-buttons">
                        <button class="role-btn" onclick="quickLogin('staff@demo.com')">üë∑ Staff</button>
                        <button class="role-btn" onclick="quickLogin('supervisor@demo.com')">üë• Supervisor</button>
                        <button class="role-btn" onclick="quickLogin('manager@demo.com')">üëî Manager</button>
                        <button class="role-btn" onclick="quickLogin('admin@demo.com')">üëë Superadmin</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboardContent" class="hidden">
            <!-- Channel Cards -->
            <div class="channel-grid">
                <!-- SS Card -->
                <div class="channel-card ss" onclick="filterByChannel('ss')">
                    <div class="channel-title">üí° SS</div>
                    <div class="channel-desc">Suggestion System untuk Staff/Operator</div>
                    <div class="channel-meta">
                        <span>Pending: <span id="ssPending" class="text-warning">0</span></span>
                        <span>Total: <span id="ssTotal">0</span></span>
                    </div>
                </div>

                <!-- QCC Card -->
                <div class="channel-card qcc" onclick="filterByChannel('qcc')">
                    <div class="channel-title">‚≠ï QCC</div>
                    <div class="channel-desc">Quality Circle Control - Staff dgn Fasilitator Supervisor</div>
                    <div class="channel-meta">
                        <span>Pending: <span id="qccPending" class="text-warning">0</span></span>
                        <span>Total: <span id="qccTotal">0</span></span>
                    </div>
                </div>

                <!-- QCP Card -->
                <div class="channel-card qcp" onclick="filterByChannel('qcp')">
                    <div class="channel-title">üîÑ QCP</div>
                    <div class="channel-desc">Quality Circle Project - Lintas Departemen</div>
                    <div class="channel-meta">
                        <span>Pending: <span id="qcpPending" class="text-warning">0</span></span>
                        <span>Total: <span id="qcpTotal">0</span></span>
                    </div>
                </div>

                <!-- OSR Card -->
                <div class="channel-card osr" onclick="filterByChannel('osr')">
                    <div class="channel-title">üìã OSR</div>
                    <div class="channel-desc">One Sheet Report untuk Supervisor</div>
                    <div class="channel-meta">
                        <span>Pending: <span id="osrPending" class="text-warning">0</span></span>
                        <span>Total: <span id="osrTotal">0</span></span>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">Total Improvement</div>
                    <div class="stat-value" id="totalImprovement">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Pending Approval</div>
                    <div class="stat-value" id="totalPending">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Approved</div>
                    <div class="stat-value" id="totalApproved">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Cost Saving</div>
                    <div class="stat-value" id="totalSaving">Rp 0</div>
                </div>
            </div>

            <!-- Improvement List -->
            <div class="table-section">
                <div class="table-header">
                    <h3>Daftar Improvement</h3>
                    <div class="filter-group">
                        <select class="filter-select" id="channelFilter" onchange="applyFilters()">
                            <option value="all">Semua Channel</option>
                            <option value="ss">SS</option>
                            <option value="qcc">QCC</option>
                            <option value="qcp">QCP</option>
                            <option value="osr">OSR</option>
                        </select>
                        <select class="filter-select" id="statusFilter" onchange="applyFilters()">
                            <option value="all">Semua Status</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                        <button class="btn btn-success" onclick="showCreateModal()" id="createBtn">+ Buat Improvement</button>
                    </div>
                </div>
                <table id="improvementTable">
                    <thead>
                        <tr>
                            <th>Channel</th>
                            <th>Judul</th>
                            <th>Pembuat</th>
                            <th>Level</th>
                            <th>Status</th>
                            <th>Approval Path</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr><td colspan="7" style="text-align:center;padding:30px;">Silakan login terlebih dahulu</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Footer -->
            <div class="footer">
                PRIMA+ COURSE ¬© 2026<br>
                People Resource ¬∑ Innovation & Mastery
            </div>
        </div>
    </div>

    <!-- Create Modal -->
    <div id="createModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Buat Improvement Baru</h3>
                <span class="modal-close" onclick="closeCreateModal()">√ó</span>
            </div>
            <form id="createForm" onsubmit="event.preventDefault(); submitCreate();">
                <div class="form-group">
                    <label>Channel Improvement</label>
                    <select id="newChannel" class="form-control" onchange="updateChannelInfo()" required>
                        <option value="">Pilih Channel</option>
                    </select>
                </div>
                
                <div id="channelInfo" class="info-highlight"></div>
                
                <div class="form-group">
                    <label>Judul Improvement</label>
                    <input type="text" id="newTitle" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>Deskripsi Lengkap</label>
                    <textarea id="newDesc" class="form-control" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Biaya Penanggulangan (Rp)</label>
                    <input type="number" id="newCost" class="form-control" min="0" value="0" required>
                </div>
                
                <div class="form-group">
                    <label>Cost Saving (Rp)</label>
                    <input type="number" id="newSaving" class="form-control" min="0" value="0" required>
                </div>
                
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Simpan</button>
                    <button type="button" class="btn btn-danger" onclick="closeCreateModal()">Batal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Approval Modal -->
    <div id="approvalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Approval Improvement</h3>
                <span class="modal-close" onclick="closeApprovalModal()">√ó</span>
            </div>
            <div id="approvalInfo" class="info-highlight"></div>
            
            <div class="form-group">
                <label>Keputusan</label>
                <select id="approvalAction" class="form-control">
                    <option value="approved">‚úÖ Approve</option>
                    <option value="rejected">‚ùå Reject</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Komentar</label>
                <textarea id="approvalComments" class="form-control" rows="3" placeholder="Tambahkan komentar..."></textarea>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="submitApproval()">Submit</button>
                <button class="btn btn-danger" onclick="closeApprovalModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Detail Improvement</h3>
                <span class="modal-close" onclick="closeDetailModal()">√ó</span>
            </div>
            <div id="detailContent"></div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeDetailModal()">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Manual Book Modal -->
    <div id="manualBookModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>Manual Book & Role Guidelines</h3>
                <span class="modal-close" onclick="closeManualBook()">√ó</span>
            </div>
            <div style="padding: 10px;">
                <h4 style="color:#1e3a8a; margin-bottom:15px;">üìã 4 LEVEL ROLE</h4>
                <table style="width:100%; border-collapse: collapse; margin-bottom:20px;">
                    <tr style="background:#f3f4f6;">
                        <th style="padding:8px; text-align:left;">Role</th>
                        <th style="padding:8px; text-align:left;">Bisa Create</th>
                        <th style="padding:8px; text-align:left;">Bisa Approve</th>
                    </tr>
                    <tr><td style="padding:8px;">üë∑ Staff/Operator</td><td>SS, QCC</td><td>-</td></tr>
                    <tr><td style="padding:8px;">üë• Supervisor</td><td>OSR</td><td>SS Level 1</td></tr>
                    <tr><td style="padding:8px;">üëî Manager</td><td>-</td><td>Semua Channel</td></tr>
                    <tr><td style="padding:8px;">üëë Superadmin</td><td>-</td><td>Semua (Full Access)</td></tr>
                </table>

                <h4 style="color:#1e3a8a; margin:20px 0 15px;">üìä 4 CHANNEL IMPROVEMENT</h4>
                <table style="width:100%; border-collapse: collapse;">
                    <tr style="background:#f3f4f6;">
                        <th style="padding:8px; text-align:left;">Channel</th>
                        <th style="padding:8px; text-align:left;">Pembuat</th>
                        <th style="padding:8px; text-align:left;">Approval Path</th>
                    </tr>
                    <tr><td style="padding:8px;">üí° SS</td><td>Staff</td><td>Supervisor ‚Üí Manager</td></tr>
                    <tr><td style="padding:8px;">‚≠ï QCC</td><td>Staff</td><td>Manager (Supervisor sebagai Fasilitator)</td></tr>
                    <tr><td style="padding:8px;">üîÑ QCP</td><td>Lintas Dept</td><td>Manager</td></tr>
                    <tr><td style="padding:8px;">üìã OSR</td><td>Supervisor</td><td>Manager</td></tr>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeManualBook()">Tutup</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== DATA STORE ====================
        let currentUser = null;
        let currentItemId = null;
        
        let improvements = [
            { id:1, channel:'ss', title:'Perbaikan tata letak tools', desc:'Tools sering hilang dan sulit ditemukan', cost:500000, saving:2000000, creator:'staff1', creatorName:'Budi Staff', creatorRole:'staff', level:1, status:'pending' },
            { id:2, channel:'ss', title:'Penambahan rak penyimpanan', desc:'Kapasitas rak tidak mencukupi', cost:1000000, saving:3000000, creator:'staff2', creatorName:'Ani Staff', creatorRole:'staff', level:1, status:'approved' },
            { id:3, channel:'qcc', title:'Reduksi scrap produksi', desc:'Scrap rate 15% perlu diturunkan', cost:2000000, saving:8000000, creator:'staff1', creatorName:'Budi Staff', creatorRole:'staff', level:2, status:'pending' },
            { id:4, channel:'qcc', title:'Optimasi waktu setup mesin', desc:'Setup terlalu lama', cost:3000000, saving:10000000, creator:'staff3', creatorName:'Citra Staff', creatorRole:'staff', level:2, status:'pending' },
            { id:5, channel:'qcp', title:'Kolaborasi QA-Produksi', desc:'Cacat produk antar departemen', cost:5000000, saving:15000000, creator:'manager1', creatorName:'Dedi Manager', creatorRole:'manager', level:2, status:'pending' },
            { id:6, channel:'osr', title:'Efisiensi rute logistik', desc:'Rute pengiriman tidak efisien', cost:2000000, saving:6000000, creator:'supervisor1', creatorName:'Eka Supervisor', creatorRole:'supervisor', level:2, status:'approved' },
            { id:7, channel:'osr', title:'Pengurangan jam overtime', desc:'Overtime melebihi budget', cost:1000000, saving:4000000, creator:'supervisor2', creatorName:'Fani Supervisor', creatorRole:'supervisor', level:2, status:'pending' }
        ];

        // ==================== INITIALIZATION ====================
        window.onload = function() {
            updateStats();
            loadImprovements();
        };

        // ==================== LOGIN FUNCTIONS ====================
        function quickLogin(email) {
            document.getElementById('email').value = email;
            document.getElementById('password').value = '123';
            document.getElementById('loginForm').dispatchEvent(new Event('submit'));
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            
            if(email.includes('staff')) {
                currentUser = { id:'staff1', name: 'Budi Staff', role: 'staff', avatar: 'S' };
            } else if(email.includes('supervisor')) {
                currentUser = { id:'supervisor1', name: 'Eka Supervisor', role: 'supervisor', avatar: 'SV' };
            } else if(email.includes('manager')) {
                currentUser = { id:'manager1', name: 'Dedi Manager', role: 'manager', avatar: 'M' };
            } else if(email.includes('admin')) {
                currentUser = { id:'admin1', name: 'Admin Super', role: 'superadmin', avatar: 'SA' };
            } else {
                alert('Email tidak dikenal');
                return;
            }

            // Update UI
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('dashboardContent').classList.remove('hidden');
            
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userId').textContent = currentUser.role;
            document.getElementById('userAvatar').textContent = currentUser.avatar;
            
            const badge = document.getElementById('roleBadge');
            badge.textContent = currentUser.role;
            badge.className = 'role-badge ' + currentUser.role;

            // Update tombol create berdasarkan role
            const createBtn = document.getElementById('createBtn');
            if(currentUser.role === 'manager' || currentUser.role === 'superadmin') {
                createBtn.style.display = 'none';
            } else {
                createBtn.style.display = 'inline-block';
            }

            updateStats();
            loadImprovements();
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('dashboardContent').classList.add('hidden');
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('overlay').classList.remove('show');
        }

        // ==================== STATS FUNCTIONS ====================
        function updateStats() {
            const total = improvements.length;
            const pending = improvements.filter(i => i.status === 'pending').length;
            const approved = improvements.filter(i => i.status === 'approved').length;
            const totalSaving = improvements.reduce((sum, i) => sum + i.saving, 0);
            
            document.getElementById('totalImprovement').textContent = total;
            document.getElementById('totalPending').textContent = pending;
            document.getElementById('totalApproved').textContent = approved;
            document.getElementById('totalSaving').textContent = 'Rp ' + (totalSaving/1000000).toFixed(0) + 'jt';

            // Hitung per channel
            const channels = ['ss', 'qcc', 'qcp', 'osr'];
            channels.forEach(ch => {
                const total = improvements.filter(i => i.channel === ch).length;
                const pending = improvements.filter(i => i.channel === ch && i.status === 'pending').length;
                document.getElementById(ch + 'Total').textContent = total;
                document.getElementById(ch + 'Pending').textContent = pending;
            });
        }

        // ==================== IMPROVEMENT FUNCTIONS ====================
        function loadImprovements() {
            if (!currentUser) return;
            
            const channelFilter = document.getElementById('channelFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            let filtered = improvements;
            
            if(channelFilter !== 'all') {
                filtered = filtered.filter(i => i.channel === channelFilter);
            }
            
            if(statusFilter !== 'all') {
                filtered = filtered.filter(i => i.status === statusFilter);
            }

            displayTable(filtered);
        }

        function applyFilters() {
            loadImprovements();
        }

        function filterByChannel(channel) {
            document.getElementById('channelFilter').value = channel;
            loadImprovements();
        }

        function navigateTo(page) {
            if(page === 'dashboard') {
                document.getElementById('channelFilter').value = 'all';
                document.getElementById('statusFilter').value = 'all';
                loadImprovements();
            } else {
                filterByChannel(page);
            }
            toggleSidebar();
        }

        function displayTable(items) {
            const tbody = document.getElementById('tableBody');
            
            if(items.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:30px;">Tidak ada data</td></tr>';
                return;
            }

            tbody.innerHTML = items.map(item => {
                const canApprove = checkCanApprove(item);
                const approvalPath = getApprovalPath(item);

                return `
                <tr>
                    <td><strong>${item.channel.toUpperCase()}</strong></td>
                    <td>${item.title}</td>
                    <td>${item.creatorName}</td>
                    <td>Level ${item.level}/2</td>
                    <td><span class="status-badge status-${item.status}">${item.status}</span></td>
                    <td>${approvalPath}</td>
                    <td>
                        ${canApprove ? `<button class="btn btn-primary btn-small" onclick="openApprovalModal(${item.id})" style="padding:3px 10px;font-size:11px;margin-right:5px;">Approve</button>` : ''}
                        <button class="btn btn-small" onclick="openDetailModal(${item.id})" style="padding:3px 10px;font-size:11px;background:#6b7280;color:white;">Detail</button>
                    </td>
                </tr>
            `}).join('');
        }

        function checkCanApprove(item) {
            if (!currentUser || item.status !== 'pending') return false;
            
            // Superadmin bisa approve semua
            if (currentUser.role === 'superadmin') return true;
            
            // Manager bisa approve semua channel di level 2
            if (currentUser.role === 'manager' && item.level === 2) return true;
            
            // Supervisor hanya bisa approve SS level 1
            if (currentUser.role === 'supervisor' && item.channel === 'ss' && item.level === 1) return true;
            
            return false;
        }

        function getApprovalPath(item) {
            if(item.channel === 'ss') {
                return item.level === 1 ? 'Menunggu Supervisor' : 'Menunggu Manager';
            } else {
                return 'Menunggu Manager';
            }
        }

        // ==================== CREATE FUNCTIONS ====================
        function showCreateModal() {
            if (!currentUser) {
                alert('Silakan login terlebih dahulu');
                return;
            }

            const channelSelect = document.getElementById('newChannel');
            channelSelect.innerHTML = '<option value="">Pilih Channel</option>';
            
            // Set channel options berdasarkan role
            if (currentUser.role === 'staff') {
                channelSelect.innerHTML += '<option value="ss">SS - Suggestion System</option>';
                channelSelect.innerHTML += '<option value="qcc">QCC - Quality Circle Control</option>';
            } else if (currentUser.role === 'supervisor') {
                channelSelect.innerHTML += '<option value="osr">OSR - One Sheet Report</option>';
            }

            document.getElementById('createModal').classList.add('show');
            updateChannelInfo();
        }

        function updateChannelInfo() {
            const channel = document.getElementById('newChannel').value;
            const infoDiv = document.getElementById('channelInfo');
            
            if(channel === 'ss') {
                infoDiv.innerHTML = 'üìã <strong>SS:</strong> Dibuat oleh Staff, akan di-approve Supervisor (Level 1) kemudian Manager (Level 2)';
            } else if(channel === 'qcc') {
                infoDiv.innerHTML = '‚≠ï <strong>QCC:</strong> Dibuat oleh Staff, Supervisor sebagai Fasilitator, Approval langsung oleh Manager';
            } else if(channel === 'qcp') {
                infoDiv.innerHTML = 'üîÑ <strong>QCP:</strong> Improvement lintas departemen, Approval langsung oleh Manager';
            } else if(channel === 'osr') {
                infoDiv.innerHTML = 'üìã <strong>OSR:</strong> Dibuat oleh Supervisor, Approval langsung oleh Manager';
            } else {
                infoDiv.innerHTML = 'Pilih channel untuk melihat informasi alur approval';
            }
        }

        function submitCreate() {
            const channel = document.getElementById('newChannel').value;
            const title = document.getElementById('newTitle').value;
            const desc = document.getElementById('newDesc').value;
            const cost = parseInt(document.getElementById('newCost').value) || 0;
            const saving = parseInt(document.getElementById('newSaving').value) || 0;

            if(!channel || !title || !desc) {
                alert('Semua field harus diisi!');
                return;
            }

            // Tentukan level awal
            let level = 1;
            if(channel === 'qcc' || channel === 'qcp' || channel === 'osr') {
                level = 2; // Langsung ke manager
            }

            const newItem = {
                id: improvements.length + 1,
                channel: channel,
                title: title,
                desc: desc,
                cost: cost,
                saving: saving,
                creator: currentUser.id,
                creatorName: currentUser.name,
                creatorRole: currentUser.role,
                level: level,
                status: 'pending'
            };

            improvements.push(newItem);
            updateStats();
            loadImprovements();
            closeCreateModal();
            alert('Improvement berhasil dibuat!');
        }

        function closeCreateModal() {
            document.getElementById('createModal').classList.remove('show');
            document.getElementById('createForm').reset();
        }

        // ==================== APPROVAL FUNCTIONS ====================
        function openApprovalModal(id) {
            currentItemId = id;
            const item = improvements.find(i => i.id === id);
            
            document.getElementById('approvalInfo').innerHTML = `
                <strong>${item.title}</strong><br>
                Channel: ${item.channel.toUpperCase()}<br>
                Level: ${item.level}/2<br>
                Pembuat: ${item.creatorName}<br>
                Biaya: Rp ${item.cost.toLocaleString()}<br>
                Cost Saving: Rp ${item.saving.toLocaleString()}
            `;
            
            document.getElementById('approvalModal').classList.add('show');
        }

        function closeApprovalModal() {
            document.getElementById('approvalModal').classList.remove('show');
            document.getElementById('approvalComments').value = '';
        }

        function submitApproval() {
            const action = document.getElementById('approvalAction').value;
            const comments = document.getElementById('approvalComments').value;
            
            const item = improvements.find(i => i.id === currentItemId);
            
            if(action === 'rejected') {
                item.status = 'rejected';
            } else {
                // Logic approval berjenjang
                if(item.channel === 'ss') {
                    if(item.level === 1 && currentUser.role === 'supervisor') {
                        item.level = 2;
                        alert('Improvement lanjut ke level Manager');
                    } else if(item.level === 2 && currentUser.role === 'manager') {
                        item.status = 'approved';
                        alert('Improvement approved final!');
                    } else if(currentUser.role === 'superadmin') {
                        item.status = 'approved';
                        alert('Improvement approved oleh Superadmin!');
                    }
                }
                else {
                    if(currentUser.role === 'manager' || currentUser.role === 'superadmin') {
                        item.status = 'approved';
                        alert('Improvement approved!');
                    }
                }
            }

            updateStats();
            loadImprovements();
            closeApprovalModal();
        }

        // ==================== DETAIL FUNCTIONS ====================
        function openDetailModal(id) {
            const item = improvements.find(i => i.id === id);
            
            document.getElementById('detailContent').innerHTML = `
                <div style="padding:10px;">
                    <h4 style="color:#1e3a8a; margin-bottom:10px;">${item.title}</h4>
                    <p><strong>Channel:</strong> ${item.channel.toUpperCase()}</p>
                    <p><strong>Deskripsi:</strong> ${item.desc}</p>
                    <p><strong>Biaya:</strong> Rp ${item.cost.toLocaleString()}</p>
                    <p><strong>Cost Saving:</strong> Rp ${item.saving.toLocaleString()}</p>
                    <p><strong>Pembuat:</strong> ${item.creatorName} (${item.creatorRole})</p>
                    <p><strong>Status:</strong> <span class="status-badge status-${item.status}">${item.status}</span></p>
                    <p><strong>Level:</strong> ${item.level}/2</p>
                </div>
            `;
            
            document.getElementById('detailModal').classList.add('show');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('show');
        }

        // ==================== MANUAL BOOK ====================
        function showManualBook() {
            document.getElementById('manualBookModal').classList.add('show');
            toggleSidebar();
        }

        function closeManualBook() {
            document.getElementById('manualBookModal').classList.remove('show');
        }

        // ==================== SIDEBAR ====================
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('show');
        }
    </script>
</body>
</html>
